_ = require("underscore")
cloudinary_config = undefined
module.exports = (new_config, new_value) ->
  if !cloudinary_config? || new_config == true
    cloudinary_url = process.env.CLOUDINARY_URL
    if cloudinary_url?
      uri = require('url').parse(cloudinary_url, true)
      cloudinary_config =
        cloud_name: 'uit',
        api_key: '778712729131144',
        api_secret: 'O1NSM7xR3hwjmumRoppB82bFjPM',
        private_cdn: false,
        secure_distribution: false
      if uri.query?        
        for k, v of require("querystring").parse(uri.query)
          cloudinary_config[k] = v
    else
      cloudinary_config = {}
  if not _.isUndefined(new_value)
    cloudinary_config[new_config] = new_value
  else if _.isString(new_config)
    return cloudinary_config[new_config]
  else if _.isObject(new_config)
    _.extend(cloudinary_config, new_config)
  cloudinary_config
